<mvsim_world version="1.0">
    <!-- ============================================
         FORKLIFT WAREHOUSE SIMULATION
         Simulación completa de almacén con forklift
         ============================================ -->

    <!-- General simulation options -->
    <simul_timestep>0</simul_timestep> <!-- Auto-determine timestep -->
    <joystick_enabled>true</joystick_enabled>

    <!-- GUI options -->
    <gui>
        <ortho>false</ortho>
        <show_forces>false</show_forces>
        <force_scale>0.01</force_scale>
        <cam_distance>30</cam_distance>
        <fov_deg>60</fov_deg>
        <refresh_fps>40</refresh_fps>
        <follow_vehicle>forklift</follow_vehicle>
    </gui>

    <!-- Light parameters -->
    <lights>
        <enable_shadows>false</enable_shadows>
        <light_azimuth_deg>45.0</light_azimuth_deg>
        <light_elevation_deg>70.0</light_elevation_deg>
    </lights>

    <!-- Variables -->
    <variable name="CEILING_HEIGHT" value="8.0"></variable>
    <variable name="WAREHOUSE_X_MIN" value="-20"></variable>
    <variable name="WAREHOUSE_X_MAX" value="25"></variable>
    <variable name="WAREHOUSE_Y_MIN" value="-15"></variable>
    <variable name="WAREHOUSE_Y_MAX" value="15"></variable>

    <!-- ========================
         SCENARIO DEFINITION
         ======================== -->

    <!-- Ground / Floor -->
    <element class="horizontal_plane">
        <cull_face>BACK</cull_face>
        <x_min>$f{WAREHOUSE_X_MIN}</x_min> <y_min>$f{WAREHOUSE_Y_MIN}</y_min>
        <x_max>$f{WAREHOUSE_X_MAX}</x_max> <y_max>$f{WAREHOUSE_Y_MAX}</y_max>
        <z>0.0</z>
        <texture>https://mrpt.github.io/mvsim-models/textures-cgbookcase/concrete-ground-1.jpg</texture>
        <texture_size_x>3.0</texture_size_x>
        <texture_size_y>3.0</texture_size_y>
    </element>

    <!-- Ceiling -->
    <element class="horizontal_plane">
        <cull_face>FRONT</cull_face>
        <x_min>$f{WAREHOUSE_X_MIN}</x_min> <y_min>$f{WAREHOUSE_Y_MIN}</y_min>
        <x_max>$f{WAREHOUSE_X_MAX}</x_max> <y_max>$f{WAREHOUSE_Y_MAX}</y_max>
        <z>$f{CEILING_HEIGHT}</z>
        <texture>https://mrpt.github.io/mvsim-models/textures-cgbookcase/BathroomTiles03_1K_BaseColor.png</texture>
        <texture_size_x>4.0</texture_size_x>
        <texture_size_y>4.0</texture_size_y>
    </element>

    <!-- Perimeter Walls -->
    <!-- West wall -->
    <element class="vertical_plane">
        <cull_face>FRONT</cull_face>
        <x0>$f{WAREHOUSE_X_MIN}</x0> <y0>$f{WAREHOUSE_Y_MAX}</y0>
        <x1>$f{WAREHOUSE_X_MIN}</x1> <y1>$f{WAREHOUSE_Y_MIN}</y1>
        <z>0.0</z> <height>$f{CEILING_HEIGHT}</height>
        <texture>https://mrpt.github.io/mvsim-models/textures-cgbookcase/wall-bricks-01.png</texture>
        <texture_size_x>4.0</texture_size_x>
        <texture_size_y>4.0</texture_size_y>
    </element>
    <!-- North wall -->
    <element class="vertical_plane">
        <cull_face>FRONT</cull_face>
        <x0>$f{WAREHOUSE_X_MAX}</x0> <y0>$f{WAREHOUSE_Y_MAX}</y0>
        <x1>$f{WAREHOUSE_X_MIN}</x1> <y1>$f{WAREHOUSE_Y_MAX}</y1>
        <z>0.0</z> <height>$f{CEILING_HEIGHT}</height>
        <texture>https://mrpt.github.io/mvsim-models/textures-cgbookcase/wall-bricks-01.png</texture>
        <texture_size_x>4.0</texture_size_x>
        <texture_size_y>4.0</texture_size_y>
    </element>
    <!-- East wall -->
    <element class="vertical_plane">
        <cull_face>FRONT</cull_face>
        <x0>$f{WAREHOUSE_X_MAX}</x0> <y0>$f{WAREHOUSE_Y_MIN}</y0>
        <x1>$f{WAREHOUSE_X_MAX}</x1> <y1>$f{WAREHOUSE_Y_MAX}</y1>
        <z>0.0</z> <height>$f{CEILING_HEIGHT}</height>
        <texture>https://mrpt.github.io/mvsim-models/textures-cgbookcase/wall-bricks-01.png</texture>
        <texture_size_x>4.0</texture_size_x>
        <texture_size_y>4.0</texture_size_y>
    </element>
    <!-- South wall -->
    <element class="vertical_plane">
        <cull_face>FRONT</cull_face>
        <x0>$f{WAREHOUSE_X_MIN}</x0> <y0>$f{WAREHOUSE_Y_MIN}</y0>
        <x1>$f{WAREHOUSE_X_MAX}</x1> <y1>$f{WAREHOUSE_Y_MIN}</y1>
        <z>0.0</z> <height>$f{CEILING_HEIGHT}</height>
        <texture>https://mrpt.github.io/mvsim-models/textures-cgbookcase/wall-bricks-01.png</texture>
        <texture_size_x>4.0</texture_size_x>
        <texture_size_y>4.0</texture_size_y>
    </element>

    <!-- =============================
         FORKLIFT CLASS DEFINITION
         Modelo simplificado diferencial
         ============================= -->
    <vehicle:class name="forklift_class">
        <!-- Dynamical model: Diferencial (más simple y funcional) -->
        <dynamics class="differential">
            <!-- Ruedas -->
            <l_wheel pos="0.0  0.5" mass="5.0" width="0.15" diameter="0.40" />
            <r_wheel pos="0.0 -0.5" mass="5.0" width="0.15" diameter="0.40" />

            <!-- Chasis -->
            <chassis mass="200.0" zmin="0.15" zmax="2.0">
            </chassis>

            <!-- Motor controller -->
            <controller class="twist_ideal">
                <max_torque>200</max_torque>
            </controller>
        </dynamics>

        <!-- Friction -->
        <friction class="default">
            <mu>0.8</mu>
            <C_damping>5</C_damping>
        </friction>

        <!-- Modelo visual del forklift -->
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/pallet_jack.zip/pallet_jack/pallet_jack.dae</model_uri>
            <model_roll>90.0</model_roll>
            <model_scale>1.5</model_scale>
        </visual>

        <!-- ===== SENSORES ===== -->

        <!-- LIDAR 2D 360° para SLAM/Mapping (montado arriba) -->
        <sensor class="laser" name="scan">
            <pose_3d>0 0 1.2 0 0 0</pose_3d>
            <fov_degrees>360</fov_degrees>
            <sensor_period>0.05</sensor_period>
            <nrays>360</nrays>
            <max_range>25.0</max_range>
            <min_range>0.1</min_range>
            <raytrace_3d>false</raytrace_3d>
            <publish_topic>/scan</publish_topic>
        </sensor>

        <!-- LIDAR frontal corto alcance (detección obstáculos) -->
        <sensor class="laser" name="front_proximity">
            <pose_3d>1.2 0 0.4 0 0 0</pose_3d>
            <fov_degrees>120</fov_degrees>
            <sensor_period>0.05</sensor_period>
            <nrays>60</nrays>
            <max_range>5.0</max_range>
            <min_range>0.05</min_range>
            <raytrace_3d>false</raytrace_3d>
            <publish_topic>/front_scan</publish_topic>
        </sensor>

        <!-- LIDAR trasero corto alcance (detección obstáculos) -->
        <sensor class="laser" name="rear_proximity">
            <pose_3d>-0.8 0 0.4 0 0 180</pose_3d>
            <fov_degrees>120</fov_degrees>
            <sensor_period>0.05</sensor_period>
            <nrays>60</nrays>
            <max_range>5.0</max_range>
            <min_range>0.05</min_range>
            <raytrace_3d>false</raytrace_3d>
            <publish_topic>/rear_scan</publish_topic>
        </sensor>

        <!-- IMU -->
        <sensor class="imu" name="imu">
            <pose_3d>0 0 0.3 0 0 0</pose_3d>
            <sensor_period>0.02</sensor_period>
        </sensor>
    </vehicle:class>

    <!-- ========================
         FORKLIFT INSTANCE
         ======================== -->
    <vehicle name="forklift" class="forklift_class">
        <init_pose>-15 0 0</init_pose>  <!-- x, y, yaw(deg) -->
    </vehicle>

    <!-- ======================================
         OBJECT CLASSES (Elementos del almacén)
         ====================================== -->

    <!-- Estanterías grandes -->
    <block:class name="shelf">
        <static>true</static>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/shelf_big_moveai.zip/shelf_big_moveai/shelf_big_movai.dae</model_uri>
            <model_roll>90.0</model_roll>
        </visual>
    </block:class>

    <!-- Pallets (elevados para que las horquillas entren en los huecos) -->
    <block:class name="pallet">
        <mass>25</mass>
        <ground_friction>0.3</ground_friction>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/pallet.zip/pallet/pallet.dae</model_uri>
            <model_roll>90.0</model_roll>
            <model_offset_z>0.08</model_offset_z>
        </visual>
    </block:class>

    <!-- Pallet Jack (transpallet manual) -->
    <block:class name="pallet_jack">
        <mass>30</mass>
        <ground_friction>0.8</ground_friction>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/pallet_jack.zip/pallet_jack/pallet_jack.dae</model_uri>
            <model_roll>90.0</model_roll>
        </visual>
    </block:class>

    <!-- Totes/Cajas -->
    <block:class name="tote">
        <mass>8</mass>
        <ground_friction>0.2</ground_friction>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/tote.dae</model_uri>
            <model_roll>90.0</model_roll>
        </visual>
    </block:class>

    <!-- Escaleras -->
    <block:class name="stairs">
        <static>true</static>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/metal-stairs.dae</model_uri>
            <model_offset_z>4.31</model_offset_z>
            <model_roll>90.0</model_roll>
        </visual>
    </block:class>

    <!-- Extintores -->
    <block:class name="extinguisher">
        <static>true</static>
        <mass>5</mass>
        <ground_friction>1</ground_friction>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/extinguisher.zip/extinguisher/extinguisher.dae</model_uri>
            <model_roll>90.0</model_roll>
        </visual>
    </block:class>

    <!-- Sillas -->
    <block:class name="chair">
        <mass>8</mass>
        <ground_friction>0.3</ground_friction>
        <shape_from_visual/>
        <visual>
            <model_uri>https://mrpt.github.io/mvsim-models/chair_x3.dae</model_uri>
            <model_roll>90.0</model_roll>
        </visual>
    </block:class>

    <!-- Cajas genéricas (colisionables) -->
    <block:class name="box_small">
        <mass>5</mass>
        <ground_friction>0.4</ground_friction>
        <zmin>0</zmin> <zmax>0.4</zmax>
        <shape_viz>
            <size>0.4 0.4 0.4</size>
            <color>#8B4513</color>
        </shape_viz>
    </block:class>

    <block:class name="box_medium">
        <mass>15</mass>
        <ground_friction>0.4</ground_friction>
        <zmin>0</zmin> <zmax>0.6</zmax>
        <shape_viz>
            <size>0.6 0.6 0.6</size>
            <color>#A0522D</color>
        </shape_viz>
    </block:class>

    <block:class name="box_large">
        <mass>30</mass>
        <ground_friction>0.5</ground_friction>
        <zmin>0</zmin> <zmax>0.8</zmax>
        <shape_viz>
            <size>0.8 0.8 0.8</size>
            <color>#CD853F</color>
        </shape_viz>
    </block:class>

    <!-- Columnas estructurales -->
    <block:class name="pillar">
        <static>true</static>
        <zmin>0</zmin> <zmax>8</zmax>
        <shape_viz>
            <size>0.4 0.4 8</size>
            <color>#505050</color>
        </shape_viz>
    </block:class>

    <!-- ======================================
         OBJECT INSTANCES (Distribución almacén)
         ====================================== -->

    <!-- ===== ESTANTERÍAS ZONA NORTE ===== -->
    <block class="shelf"> <init_pose>0 10 0</init_pose> </block>
    <block class="shelf"> <init_pose>0 13 180</init_pose> </block>
    <block class="shelf"> <init_pose>8 10 0</init_pose> </block>
    <block class="shelf"> <init_pose>8 13 180</init_pose> </block>
    <block class="shelf"> <init_pose>16 10 0</init_pose> </block>
    <block class="shelf"> <init_pose>16 13 180</init_pose> </block>

    <!-- ===== ESTANTERÍAS ZONA SUR ===== -->
    <block class="shelf"> <init_pose>0 -10 0</init_pose> </block>
    <block class="shelf"> <init_pose>0 -13 180</init_pose> </block>
    <block class="shelf"> <init_pose>8 -10 0</init_pose> </block>
    <block class="shelf"> <init_pose>8 -13 180</init_pose> </block>
    <block class="shelf"> <init_pose>16 -10 0</init_pose> </block>
    <block class="shelf"> <init_pose>16 -13 180</init_pose> </block>

    <!-- ===== ESTANTERÍAS ZONA ESTE (perpendiculares) ===== -->
    <block class="shelf"> <init_pose>22 5 90</init_pose> </block>
    <block class="shelf"> <init_pose>22 -5 90</init_pose> </block>

    <!-- ===== ZONA DE CARGA/DESCARGA (Oeste) ===== -->
    <!-- Pallets en zona de recepción (CON NOMBRES para control programático) -->
    <block class="pallet" name="pallet_1"> <init_pose>-17 8 0</init_pose> </block>
    <block class="pallet" name="pallet_2"> <init_pose>-15 8 5</init_pose> </block>
    <block class="pallet" name="pallet_3"> <init_pose>-13 8 -3</init_pose> </block>
    <block class="pallet" name="pallet_4"> <init_pose>-17 5 0</init_pose> </block>
    <block class="pallet" name="pallet_5"> <init_pose>-15 5 2</init_pose> </block>
    
    <!-- Pallets en zona de expedición (CON NOMBRES) -->
    <block class="pallet" name="pallet_6"> <init_pose>-17 -8 0</init_pose> </block>
    <block class="pallet" name="pallet_7"> <init_pose>-15 -8 -5</init_pose> </block>
    <block class="pallet" name="pallet_8"> <init_pose>-13 -8 8</init_pose> </block>
    <block class="pallet" name="pallet_9"> <init_pose>-17 -5 0</init_pose> </block>

    <!-- ===== PALLETS EN PASILLOS (CON NOMBRES) ===== -->
    <block class="pallet" name="pallet_10"> <init_pose>4 6 85</init_pose> </block>
    <block class="pallet" name="pallet_11"> <init_pose>4 4.8 88</init_pose> </block>
    <block class="pallet" name="pallet_12"> <init_pose>12 -6 92</init_pose> </block>
    <block class="pallet" name="pallet_13"> <init_pose>12 -4.9 87</init_pose> </block>

    <!-- ===== CAJAS DISPERSAS ===== -->
    <block class="box_small"> <init_pose>-5 3 15</init_pose> </block>
    <block class="box_small"> <init_pose>-4.5 3.3 -20</init_pose> </block>
    <block class="box_medium"> <init_pose>-5.5 2.8 5</init_pose> </block>
    <block class="box_large"> <init_pose>10 0 0</init_pose> </block>
    <block class="box_medium"> <init_pose>6 -2 45</init_pose> </block>
    <block class="box_small"> <init_pose>6.4 -1.6 30</init_pose> </block>

    <!-- ===== TOTES ===== -->
    <block class="tote"> <init_pose>-3 7 -40</init_pose> </block>
    <block class="tote"> <init_pose>-2 7.3 10</init_pose> </block>
    <block class="tote"> <init_pose>5 -7 20</init_pose> </block>
    <block class="tote"> <init_pose>5.5 -6.5 -15</init_pose> </block>

    <!-- ===== PALLET JACKS ===== -->
    <block class="pallet_jack"> <init_pose>-10 12 90</init_pose> </block>
    <block class="pallet_jack"> <init_pose>-8 -12 -80</init_pose> </block>

    <!-- Pallet Jack animado (trabajador virtual) -->
    <block class="pallet_jack"> 
        <init_pose>0 0 0</init_pose>
        <animation type="keyframes">
            <time_pose>0.0   20 0 180</time_pose>
            <time_pose>15.0  -5 0 180</time_pose>
            <time_pose>17.0  -5 0 180</time_pose>
            <time_pose>20.0  -5 0 0</time_pose>
            <time_pose>35.0  20 0 0</time_pose>
            <time_pose>37.0  20 0 0</time_pose>
            <time_pose>40.0  20 0 180</time_pose>
        </animation>
    </block>

    <!-- ===== ESCALERAS DE EMERGENCIA ===== -->
    <block class="stairs"> <init_pose>-18 -13 -90</init_pose> </block>
    <block class="stairs"> <init_pose>23 13 90</init_pose> </block>

    <!-- ===== EXTINTORES ===== -->
    <block class="extinguisher"> <init_pose3d>-19.5 14 1.1 90 0 0</init_pose3d> </block>
    <block class="extinguisher"> <init_pose3d>24.5 14 1.1 180 0 0</init_pose3d> </block>
    <block class="extinguisher"> <init_pose3d>24.5 -14 1.1 180 0 0</init_pose3d> </block>
    <block class="extinguisher"> <init_pose3d>-19.5 -14 1.1 90 0 0</init_pose3d> </block>
    <block class="extinguisher"> <init_pose3d>5 14.5 1.1 0 0 0</init_pose3d> </block>

    <!-- ===== ZONA DE OFICINA (esquina noroeste) ===== -->
    <block class="chair"> <init_pose>-18 12 90</init_pose> </block>
    <block class="chair"> <init_pose>-18 10 90</init_pose> </block>

    <!-- ===== COLUMNAS ESTRUCTURALES ===== -->
    <block class="pillar"> <init_pose>-10 0 0</init_pose> </block>
    <block class="pillar"> <init_pose>0 0 0</init_pose> </block>
    <block class="pillar"> <init_pose>10 0 0</init_pose> </block>
    <block class="pillar"> <init_pose>20 0 0</init_pose> </block>

</mvsim_world>
